source: dasmeta/service/aws
version: 1.1.4
variables:
  name: frontend
  create_namespace: true
  namespace: frontend
  cluster_name: "eks-prod"
  alarms:
    enabled: false
  helm_values:
    image:
      repository: public.ecr.aws/r0j4a4t3/demo-frontend
      tag: latest
    podAnnotations:
      linkerd.io/inject: enabled
    containerPort: 80
    service:
      port: 80
      annotations:
        linkerd.io/inject: enabled
providers:
  - name: aws
    version: ~> 4.0
    module_nested_provider: true
    variables:
      default_tags:
        tags:
          Account: prod
          ManageLevel: product
  - name: kubernetes
    version: ~> 2.23
    module_nested_provider: true
    source: "hashicorp/kubernetes"
    variables:
      cluster_ca_certificate: ${1-environments/prod/eks.cluster_certificate}
      host: ${1-environments/prod/eks.cluster_host}
    blocks:
      exec:
        api_version: "client.authentication.k8s.io/v1beta1"
        args:
          - "eks"
          - "--region"
          - "eu-central-1"
          - "get-token"
          - "--cluster-name"
          - "eks-prod"
        command: "aws"
  - name: helm
    version: "2.10.1"
    source: "hashicorp/helm"
    blocks:
      kubernetes:
        cluster_ca_certificate: ${1-environments/prod/eks.cluster_certificate}
        host: ${1-environments/prod/eks.cluster_host}
        blocks:
          exec:
            api_version: "client.authentication.k8s.io/v1beta1"
            args:
              - "eks"
              - "--region"
              - "eu-central-1"
              - "get-token"
              - "--cluster-name"
              - "eks-dev"
            command: "aws"
linked_workspaces:
  - 1-environments/prod/eks